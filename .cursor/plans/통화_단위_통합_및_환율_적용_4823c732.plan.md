---
name: 통화 단위 통합 및 환율 적용
overview: 미국 주식의 경우 USD로 거래되지만, 한국 거주자이므로 총 자산과 총 수익은 원화(KRW)로 합산하고, 개별 종목은 USD와 KRW를 동시에 표시하도록 구현합니다.
todos: []
---

# 통화 단위 통합 및 환율 적용



## 문제 분석

현재 시스템은 모든 자산을 원화로만 표시하고 있습니다. 미국 주식의 경우:

- USD로 거래되지만
- 한국 거주자이므로 총 자산/수익은 원화로 합산해야 함
- 개별 종목은 USD와 KRW를 동시에 표시해야 함
- 환율은 조회 시점의 실시간 환율 사용

## 구현 계획

### 1. 환율 서비스 생성

**파일**: `src/services/exchangeRate.ts`

- USD/KRW 환율을 가져오는 함수 생성
- Yahoo Finance API를 사용하여 `USDKRW=X` 티커로 환율 조회
- 캐싱 메커니즘 추가 (5분 TTL, `quoteCache`와 유사한 구조)

### 2. Asset 타입 확장

**파일**: `src/types.ts`

- `Asset` 인터페이스에 `currency` 필드 추가 (옵셔널)
- `QuoteData`에서 가져온 currency 정보를 저장

### 3. useAssets 훅 수정

**파일**: `src/hooks/useAssets.ts`

- 환율 정보를 가져오는 로직 추가
- `stats` 계산 시:
- 자산의 `currency`가 `USD`인 경우 환율을 적용하여 원화로 변환
- `metadata.country`가 '미국'인 경우도 환율 적용
- `historyData` 계산 시에도 동일한 환율 적용

### 4. priceApi 수정

**파일**: `src/services/priceApi.ts`

- `fetchStockPrice`에서 가져온 `QuoteData`의 `currency` 정보를 반환하도록 수정
- 또는 `Asset`에 `currency` 정보를 저장하도록 `useAssets`에서 처리

### 5. AssetList 컴포넌트 수정

**파일**: `src/components/AssetList.tsx`

- 미국 주식인 경우 (currency가 USD이거나 country가 '미국'):
- USD 금액과 KRW 금액을 동시에 표시
- 예: `$1,234.56 (₩1,650,000)`
- 환율 정보를 props로 받거나 훅에서 가져오기

### 6. useAssets에서 currency 정보 저장

**파일**: `src/hooks/useAssets.ts`

- `loadData` 함수에서 가격 조회 시 `currency` 정보도 함께 저장
- `quoteCache.getQuote()`에서 반환된 `currency`를 `Asset`에 저장

## 데이터 흐름

```javascript
1. 자산 로드 → 가격 조회 (quoteCache)
   ↓
2. QuoteData에서 currency 정보 추출
   ↓
3. Asset에 currency 저장
   ↓
4. 환율 조회 (USDKRW=X)
   ↓
5. 통계 계산 시 USD 자산은 환율 적용하여 KRW로 변환
   ↓
6. DashboardContent: 총 자산/수익은 KRW로 표시
   ↓
7. AssetList: 개별 종목은 USD와 KRW 동시 표시
```



## 주요 변경 사항

1. **환율 서비스**: `src/services/exchangeRate.ts` 신규 생성
2. **타입 확장**: `Asset`에 `currency?: string` 추가
3. **통계 계산**: `useAssets.ts`에서 환율 적용 로직 추가
4. **UI 표시**: `AssetList.tsx`에서 이중 통화 표시

## 고려사항