---
name: 티커 입력 시 종목명 자동 조회 기능 구현
overview: AssetForm 컴포넌트에서 티커 입력 시 종목명, 국가, 통화를 자동으로 조회하고 표시하는 기능을 구현합니다.
todos: []
---

# 티커 입력 시 종목명 자동 조회 기능 구현

## 목표

`AssetForm` 컴포넌트의 티커 입력 필드에 값을 입력하면, 종목명, 국가, 통화를 자동으로 조회하고 각 필드에 자동으로 입력되도록 구현합니다.

## 구현 완료된 기능

### 1. 종목명 자동 조회 ✅

- `src/lib/api.ts`에 `getStockName(symbol: string)` 함수 구현
- Cloud Run 백엔드 `/stocks-name/${symbol}?fields=name` 엔드포인트 호출
- 티커 입력 시 800ms debounce 후 자동으로 종목명 조회
- 조회된 종목명을 이름 필드에 자동 입력

### 2. 국가 자동 조회 ✅

- `src/lib/api.ts`에 `getStockCountry(symbol: string)` 함수 구현
- Cloud Run 백엔드 `/stocks-name/${symbol}?fields=country` 엔드포인트 호출
- 기존 드롭다운 제거하고 readOnly 텍스트 입력 필드로 변경
- 티커 입력 시 자동으로 국가 정보 조회 및 표시
- 국가 필드는 사용자가 수정할 수 없음 (API에서 자동 조회)

### 3. 통화 자동 조회 ✅

- Supabase `stock_names` 테이블에서 직접 조회
- `stock_names` 테이블의 `currency` 컬럼에서 통화 정보 가져오기
- 통화 필드를 readOnly 텍스트 입력 필드로 추가
- 국가와 통화 필드를 2분할 레이아웃으로 배치 (grid-cols-2)
- 티커 입력 시 자동으로 통화 정보 조회 및 표시

### 4. managed_stocks 테이블 저장 기능 ✅

- 티커 저장 시 국가가 'KR' 또는 '한국'인 경우 티커 뒤에 '.KS' 자동 추가
- `managed_stocks` 테이블에 `country`, `currency` 컬럼 저장
- 이미 '.KS'가 붙어있는 경우 중복 추가하지 않음

## 주요 변경 파일

- `src/lib/api.ts` - API 호출 함수들 (`getStockName`, `getStockCountry`)
- `src/components/AssetForm.tsx` - 자동 조회 로직 및 UI 수정
- `src/types.ts` - `AssetMetadata`에 `currency` 필드 추가

## 구현 세부사항

### API 함수 (`src/lib/api.ts`)

- `getStockName(symbol)`: 종목명 조회 (`fields=name`)
- `getStockCountry(symbol)`: 국가 조회 (`fields=country`)
- `StockName` 인터페이스에 `currency` 필드 포함

### AssetForm 컴포넌트

- 티커 변경 시 3개의 `useEffect`로 각각 종목명, 국가, 통화 조회
- 모든 조회에 800ms debounce 적용
- 통화는 Supabase에서 직접 조회 (API 호출 없음)
- 국가와 통화 필드는 readOnly로 설정하여 사용자 수정 불가

### 데이터 저장

- `saveTickerToManagedStocks` 함수에서:
  - 국가가 'KR' 또는 '한국'인 경우 티커에 '.KS' 자동 추가
  - `managed_stocks` 테이블에 `symbol`, `name`, `country`, `currency` 저장

## 참고사항

- 기존 debounce 로직(800ms) 유지
- `isFetchingName` 상태를 사용한 로딩 표시 유지
- `nameFetchedRef`를 사용한 중복 조회 방지 로직 유지
- 통화는 Supabase에서 직접 조회하므로 더 빠르고 효율적
- 국가와 통화는 API/Supabase에서 자동으로 설정되므로 사용자가 수정할 수 없음